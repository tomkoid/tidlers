when:
  - event: [push, pull_request, tag]

steps:
  check:
    image: rust:latest
    commands:
      - cargo check --workspace --all-targets

  clippy:
    image: rust:latest
    commands:
      - rustup component add clippy
      - cargo clippy --workspace --all-targets -- -D warnings

  test:
    image: rust:latest
    commands:
      - cargo test --workspace --all-targets

  fmt:
    image: rust:latest
    commands:
      - rustup component add rustfmt
      - cargo fmt --all -- --check

  build:
    image: rust:latest
    commands:
      - cargo build --workspace --release
